@import "widgets";

$screenx: "only screen and (min-width: 18em)";
$screenxx: "only screen and (min-width: 27em)";
$screenxxx: "only screen and (min-width: 50em)";
$screenxxxx: "only screen and (min-width: 70em)";

$width-room: 15em;
$width-roomx: 15em;
$width-roomxx: 15em;
$width-roomxxx: 15em;
$width-roomxxxx: 16%;

$width-meta: 13em;
$width-metax: 19em;
$width-metaxx: 25em;
$width-metaxxx: 26em;
$width-metaxxxx: 30%;

$bar-height: 3.5em;

$settingsitems: general, irc, twitter, thread, permissions, requests, spam, seo, customization, embed, profile, email, notification;
$tabitems: info, people, threads;
$modeitems: normal, search, conf, pref, home;

/* widget styles */
@mixin display-in($modes, $display: block) {
    display: none;

    @each $mode in $modes {
        .#{$mode}-mode & { display: $display; }
    }
}

%scroll-elem {
    overflow-y: scroll;
    -webkit-overflow-scrolling : touch;
}

%column {
    position: fixed;
    top: 0;
    bottom: 0;
    min-height: 100%;
}

.room-area {
    @extend %column;

    left: ( $width-room + $width-meta ) * -1;
    width: $width-room;
    background-color: $dark-color;
    color: $light-color;

    @media #{$screenx} {
        left: ( $width-roomx + $width-metax ) * -1;
        width: $width-roomx;
    }

    @media #{$screenxx} {
        left: ( $width-roomxx + $width-metaxx ) * -1;
        width: $width-roomxx;
    }

    @media #{$screenxxx} {
        left: $width-roomxxx * -1;
        width: $width-roomxxx;
    }

    @media #{$screenxxxx} {
        left: 0;
        width: $width-roomxxxx;
    }

    .embed & { display: none; }
}

.room-header {
    height: $bar-height;
    padding: .5em 1em;
    border-bottom: 1px solid lighten($dark-color, 5%);
    cursor: pointer;

    img {
        height: 2.5em;
        width: auto;
    }
}

.room-list {
    height: 100%;

    @extend %scroll-elem;
}

.room-item {
    @extend %ease;

    display: block;
    padding: 1em;
    font-weight: 700;
    color: $light-color;
    border-bottom: 1px solid lighten($dark-color, 5%);

    &:hover, &:focus, &.current:hover, &.current:focus {
        color: $light-color;
        background-color: darken($dark-color, 10%);
    }

    &.current {
        position: relative;
        background-color: darken($dark-color, 5%);

        &:after {
            content: "";
            display: block;
            position: absolute;
            right: 0;
            top: 1.2em;
            border-top: .6em solid transparent;
            border-bottom: .6em solid transparent;
            border-right: .6em solid darken($light-color, 5%);
        }
    }

    &.search-term { background: url(../../img/client/icons/search-light.svg) no-repeat 90% center 2em/2em; }

    .unread {
        float: right;
        min-width: 2em;
        text-align: center;
        font-size: .8em;
        background-color: $accent-color;
        color: $light-color;
        border-radius: $roundness;

        &:empty { display: none; }

        &.mentioned { background-color: $error-color; }
    }
}

.meta-area {
    @extend %column;

    left: $width-meta * -1;
    width: $width-meta;
    border-right: 1px solid darken($light-color, 15%);
    background-color: darken($light-color, 5%);
    color: $dark-color;

    @media #{$screenx} {
        left: $width-metax * -1;
        width: $width-metax;
    }

    @media #{$screenxx} {
        left: $width-metaxx * -1;
        width: $width-metaxx;
    }

    @media #{$screenxxx} {
        left: 0;
        width: $width-metaxxx;
    }

    @media #{$screenxxxx} {
        width: $width-metaxxxx;
        left: $width-roomxxxx;

        .embed & { left: 0; }
    }
}

.meta-tabs {
    list-style: none;
    display: table;
    table-layout: fixed;
    margin: 0;
    width: 100%;
    height: $bar-height;
    border-bottom: 1px solid darken($light-color, 15%);

    li {
        @include transform(rotate(0deg)); /* hack to fix invisible items in android browser */
        @extend %ease;

        display: none;
        vertical-align: middle;
        color: $dark-color;
        cursor: pointer;

        @each $mode in $modeitems {
            &.mode-#{$mode} {
                .#{$mode}-mode & { display: table-cell; }
            }
        }

        &.rooms-button {
            @include transition(.5s);

            display: table-cell;
            width: 2.5em;
            background: url(../../img/client/icons/back.svg) no-repeat center center;

            .rooms-view & { @include transform(rotate(180deg)); }

            .embed & { display: none; }

            @media #{$screenxxxx} { display: none;    }
        }

        h3 { margin: 0; }
    }

    .header {
        padding-left: 1.5em;
        text-transform: uppercase;

        @media #{$screenxxxx} {
            padding-left: 4.25em;
            background: url(../../img/client/icons/settings.svg) 1em center no-repeat;
        }
    }

    .tab {
        @include opacity(0.3);

        text-align: center;
        background-position: center center;
        background-repeat: no-repeat;
        background-size: 2em 2em;

        @each $item in $tabitems {
            &.tab-#{$item} { background-image: url(../../img/client/icons/#{$item}.svg); }
        }

        &:hover, &:focus, &:active, &.current {
            @include opacity(1);
            @extend %nofilter;

            background-color: darken($light-color, 15%);
        }

        &.current { background-color: darken($light-color, 10%); }
    }
}

.meta-panes {
    @include display-in(normal search);

    display: none;
    position: relative;
    height: 100%;

    .pane {
        @extend %scroll-elem;

        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        display: none;

        &.current {
            @include fadein;
            @extend %nofilter;

            display: block;
        }
    }
}

.pane-info {
    padding: 0 1.5em;

    .guest-user & {
        .configure-button { display: none; }
    }
}

.pane-people {
    padding: .75em;

    .infinite-above, .infinite-below {
        background-color: transparent;
        background-image:  linear-gradient(to right, darken($light-color, 5%), darken($light-color, 5%) 15%, transparent 15%, transparent 85%, darken($light-color, 5%) 85%, darken($light-color, 5%)),
                           linear-gradient(to bottom, transparent, transparent 25%, darken($light-color, 15%) 25%, darken($light-color, 15%) 65%, transparent 65%, transparent 75%, darken($light-color, 15%) 75%, darken($light-color, 15%) 85%, transparent 85%, transparent);
        background-size: 5.5em 8em;
		background-position: top left;
		background-repeat: repeat;
		background-repeat: round; /* limited browser support */
	}

	.person {
		@extend %nofilter;
		@extend %ease;

		display: inline-block;
		padding: .25em;
		width: 5.5em;
		text-align: center;
		text-overflow: ellipsis;
		white-space: nowrap;
		overflow: hidden;
		font-weight: 400;
		color: $dark-color;

		&:hover, &:focus {
			background-color: $accent-color;
			color: $light-color;
			border-radius: $roundness;
		}

		&.offline {
			@include opacity(.5);

			.picture { @extend %grayscale; }
		}

		.person-avatar {
			display: block;
			width: 4em;
			height: 4em;
			margin: .25em .5em;
			border-radius: $roundness;
		}
	}
}

.pane-threads {
	.infinite-above, .infinite-below {
		background-color: transparent;
		background-image:  linear-gradient(to bottom, transparent, transparent 35%, darken($light-color, 15%) 35%, darken($light-color, 15%) 65%, transparent 65%, transparent),
						   linear-gradient(to bottom, darken($light-color, 15%), darken($light-color, 15%));
		background-size: 60% 3em, 4px 100%;
		background-position: 2em center, center right;
		background-repeat: repeat-y;
	}

	.thread {
		@extend %nofilter;
		@extend %ease;

		display: block;
		padding: .5em 2em;
		font-weight: 400;
		color: $dark-color;
		border-right: 4px solid $accent-color;

		&.current { background-color: lighten($accent-color, 30%); }

		&:hover, &:focus, &.current:hover, &.current:focus {
			background-color: $accent-color;
			color: $light-color;
		}

		@for $i from 1 through length($palette) {
			$color: nth($palette, $i);
			$j: $i - 1;

			&.conv-#{$j} {
				border-right-color: $color;

				&.current { background-color: lighten($color, 30%); }

				&:hover, &:focus, &.current:hover, &.current:focus { background-color: $color; }
			}
		}
	}
}

.meta-conf { @include display-in(conf); }

.meta-pref { @include display-in(pref); }

.meta-conf, .meta-pref {
    @extend %scroll-elem;

    height: 100%;
}

.list-item {
	@extend %ease;

	display: block;
	font-size: 1.5em;
	padding: .75em;
	padding-left: 2.75em;
	background-size: 24px 24px;
	background-position: .75em center;
	background-repeat: no-repeat;
	border-bottom: 1px solid darken($light-color, 10%);
	color: $dark-color;
	cursor: pointer;

	&.current { background-color: darken($light-color, 10%); }

	&:hover, &:focus, &.current:hover, &.current:focus {
		background-color: darken($light-color, 15%);
		color: $dark-color;
	}

	@each $item in $settingsitems {
		&.list-item-#{$item}-settings {
			background-image: url(../../img/client/icons/#{$item}-settings.svg);
		}
	}
}

@mixin chat-elem {
	position: fixed;
    left: 0;
    right: 0;

    @media #{$screenxxx} { left: $width-metaxxx; }

	@media #{$screenxxxx} {
		left: $width-roomxxxx + $width-metaxxxx;

		.embed & { left: $width-metaxxxx; }
	}
}

.main-area {
	@extend %column;
	@include chat-elem;
}

.content-area { @include display-in(normal search); }

.title-bar {
	position: relative;
	display: table;
	height: $bar-height;
	width: 100%;
	z-index: 20;
	background-color: darken($light-color, 5%);
	box-shadow: inset 0 -1px 0 0 darken($light-color, 20%),
				0 3px 2px -1px rgba(0,0,0,0.05);
}

.meta-button {
	@include transform(rotate(0deg));
	@include transition(.5s);

	display: table-cell;
	width: 3em;
	height: 100%;
	background: url(../../img/client/icons/back.svg) center center no-repeat;
	background-size: 2em 2em;
	cursor: pointer;

	.meta-view & { @include transform(rotate(180deg)); }

	@media #{$screenxxx} { display: none; }
}

.action-buttons {
	display: table-cell;
	padding: .15em;

	.button { margin: 0; }
}

.left-area {
	display: table-cell;
	vertical-align: middle;
	padding-left: 0;

	@media #{$screenxxx} { padding-left: 1em;  }

	h2 {
		display: table-cell;
		font-size: 1.5em;
		margin: 0;
	}

	.follow-button {
        @include display-in(normal, table-cell);

		width: 4em;
		height: 2em;
		background: url(../../img/client/icons/follow-no.svg) center center no-repeat;
		background-size: 2em 2em;
		cursor: pointer;

		.following & { background: url(../../img/client/icons/follow.svg) center center no-repeat; }
	}
}

.right-area {
	display: table-cell;
	vertical-align: middle;

	.search-button {
		float: right;
		height: $bar-height;
		padding: 0 1em;
		width: 4em;
		background: url(../../img/client/icons/search.svg) center center no-repeat;
		background-size: 2em 2em;
		cursor: pointer;

		.embed & { display: none;}
	}

	.user-area {
		float: right;
		height: $bar-height;

		.user-detail {
			float: right;
			text-align: right;
			padding: 1em;
			font-weight: 700;
			cursor: pointer;

			.guest-user & { padding: .2em 1em; }

			.sign-in {
				display: none;

				.guest-user & {
					display: inline;
					text-transform: uppercase;
				}
			}
		}

		.user-avatar {
			display: none;

			@media #{$screenxx} {
				display: block;
				float: right;
				cursor: pointer;

				img {
					display: block;
					height: $bar-height;
					width: $bar-height;
				}
			}
		}
	}
}

.chat-area {
    @extend %scroll-elem;

	position: absolute;
    top: $bar-height;
    bottom: $bar-height;
	right: 0;
    left: 0;
    background-color: $light-color;

	.infinite-above, .infinite-below {
		background-color: transparent;
		background-image: linear-gradient(to bottom, transparent, transparent 30%, lighten($accent-color, 40%) 30%, lighten($accent-color, 40%) 40%, transparent 40%, transparent),
			linear-gradient(to bottom, transparent, transparent 30%, darken($light-color, 5%) 30%, darken($light-color, 5%) 40%, transparent 40%, transparent),
			linear-gradient(to bottom, transparent, transparent 60%, darken($light-color, 5%) 60%, darken($light-color, 5%) 70%, transparent 70%, transparent);
		background-size: .6em 6em, 80% 6em, 60% 6em;
		background-position: 1em 2em, 3em 2em, 3em 2em;
		background-repeat: repeat-y;
		background-attachment: scroll;

		@media #{$screenxx} {
			background-image: linear-gradient(to bottom, transparent, transparent 30%, lighten($accent-color, 40%) 30%, lighten($accent-color, 40%) 40%, transparent 40%, transparent),
				linear-gradient(to bottom, transparent, transparent 30%, darken($light-color, 5%) 30%, darken($light-color, 5%) 40%, transparent 40%, transparent),
				linear-gradient(to bottom, transparent, transparent 30%, darken($light-color, 5%) 30%, darken($light-color, 5%) 40%, transparent 40%, transparent),
				linear-gradient(to bottom, transparent, transparent 60%, darken($light-color, 5%) 60%, darken($light-color, 5%) 70%, transparent 70%, transparent);
			background-size: .6em 6em, 6em 6em, 80% 6em, 60% 6em;
			background-position: 2em 2em, 4em 2em, 12em 2em, 12em 2em;
		}
	}
}

.chat-position {
	@include opacity(0);
	@extend %ease;

	position: relative;
	float: right;
	margin: 1em;
	padding: .5em 1em;
	background-color: $dark-color;
	color: $light-color;
	border-radius: $roundness;
	pointer-events: none;
	z-index: 20;

	.scrolling & {
		@include opacity(1);
		@extend %nofilter;
	}
}

.chat-item {
	@include fadein;
	@extend %ease;
	@extend %nofilter;

	position: relative;
	margin: 0;
	padding: 1em;
	padding-left: 3.5em;
	border-top: 1px solid darken($light-color, 5%);
	overflow: hidden;

	@media #{$screenxx} { padding-left: 12em; }

	&:hover, &:focus { background-color: darken($light-color, 1%); }

	&.current {
		background-color: darken($light-color, 3%);

		.chat-more { background-color: darken($light-color, 3%); }
	}

	&:hover, &:focus, &.current {
		border-top: 1px solid darken($light-color, 10%);

		& + .chat-item { border-top: 1px solid darken($light-color, 10%); }

		.chat-timestamp { color: lighten($dark-color, 10%); }

		.chat-more { @include transform(translate3d(0, 0, 0)); }
	}

	&:before {
		content: "";
		float: left;
		margin: .55em 0 auto -2em;
		height: .5em;
		width: .5em;
		border-radius: 50%;
		background-color: $accent-color;

		@media #{$screenxx} { margin-left: -10em; }
	}

	/* set conversations dot colors */
	@for $i from 1 through length($palette) {
		$color: nth($palette, $i);
		$j: $i - 1;

		&.conv-#{$j}:before { background-color: $color; }
	}

	&.long {
		@extend %ease;

		max-height: 12em;
		cursor: pointer;

		&:hover, &:focus {
			&:after { padding: 1em 0; }
		}

		&:after {
			@extend %ease;

			content: "";
			position: absolute;
			display: block;
			bottom: 0;
			width: 100%;
			padding: 3em 0;
			background-image: linear-gradient(to bottom, fade-out($light-color, 1) 0%, $light-color 100%);
		}

		&.active {
			max-height: 20em;
			overflow: auto;

			&:after { display: none; }
		}
	}

	a {
		color: darken($accent-color, 15%);

		&:hover, &:focus { text-decoration: underline;}

		&:active { color: darken($accent-color, 30%); }
	}

	.chat-timestamp { display: none; }

	&.timestamp-displayed {
		.chat-timestamp {
			display: block;
			font-size: .9em;
			text-align: right;
			color: lighten($dark-color, 30%);
		}
	}
}

.chat-nick {
	float: left;
	margin-left: 0;
	padding-right: 1em;
	font-weight: 700;

	&:after { content: " :" }

	@media #{$screenxx} {
		margin-left: -8em;

		&:after { content: "" }
	}

	a {
		color: $dark-color;

		&:hover, &:focus, &:active { color: darken($dark-color, 10%); }
	}
}

.chat-more {
	@include transform(translate3d(-3.5em, 0, 0));
	@extend %ease;

	position: absolute;
	display: block;
	background-color: darken($light-color, 1%);
	background-image: url(../../img/client/icons/more.svg);
	background-repeat: no-repeat;
	background-position: top center;
	background-size: 3.5em 3.5em;
	width: 3.5em;
	height: 3.5em;
	top: 0;
	left: 0;
	cursor: pointer;
}

.chat-input {
	@include chat-elem;
    @include display-in(normal search);

	bottom: 0;
    padding: 0;
    min-height: $bar-height;
    box-shadow: 0 -3px 2px -1px rgba(0,0,0,0.05);
}

.chat-entry {
	@extend .entry;

	word-wrap: break-word;
	width: 100%;
	min-height: $bar-height;
	max-height: 12em;
	padding: .9em 1em;
	padding-right: 2.5em;
	overflow: auto;
	border-radius: 0;

	&:hover, &:focus, &:active {
		border-color: $accent-color;
		outline: none;

		@for $i from 1 through length($palette) {
			$j: $i - 1;

			.conv-#{$j} & { border-color: nth($palette, $i); }
		}
	}
}

.chat-send {
	@extend %ease;

	position: absolute;
	right: 0;
	bottom: 0;
	margin: 0;
	padding: .75em;
	height: 3.5em;
	width: 3.5em;
	border: none;
	cursor: pointer;
	fill: lighten($dark-color, 30%); /* inline SVG */

	&:hover, &:focus, &:active { fill: $dark-color; }

	@for $i from 1 through length($palette) {
		$color: nth($palette, $i);
		$j: $i - 1;

		.conv-#{$j} & {
			fill: $color;

			&:hover, &:focus, &:active { fill: darken($color, 15%); }
		}
	}
}

.settings-area { @include display-in(conf pref); }

.conf-area, .pref-area {
    @extend %scroll-elem;

	position: absolute;
	top: $bar-height;
	right: 0;
	bottom: 0;
	left: 0;

	.list-view {
		display: none;

		&.current {
			@include fadein;
			@extend %nofilter;

			display: block;
			max-width: 100%;

			@media #{$screenxx} {
				display: table;
				border-spacing: 2em;
			}
		}

		.request-msg {
			display: table-row;

			img {
				max-width: 80px;
				max-height: 80px;
				border-radius: $roundness;
			}

			img, .request-details {
				display: table-cell;
				vertical-align: top;
			}

			.username {
				a {
					font-size: 1.2em;
					color: $dark-color;

					&:hover, &:focus, &:active { color: darken($dark-color, 10%); }
				}
			}

			.button, .button-secondary { padding: .5em 1em; }
		}

		.twitter-account {
			position: relative;
			color: $light-color;

			img {
				height: 80px;
				width: 80px;
				border-radius: $roundness;
			}

			.change {
				position: absolute;
				left: 0;
				right: 0;
				bottom: 0;
				width: 80px;
				padding: .75em;
				background-color: $accent-color;
				text-transform: uppercase;
				border-radius: 0 0 $roundness $roundness;
			}
		}
	}
}

.settings-item {
	display: block;
	padding: 1em;

	@media #{$screenxx} { display: table-row; }

	.settings-label, .settings-action {
		display: block;
		padding: .25em;

		@media #{$screenxx} { display: table-cell; }

		input, textarea, .button, .button-secondary {
			margin: 0 0;
			max-width: 100%;
		}

		input[type=text], textarea, .entry { width: 100% }

		textarea { resize: vertical; }

		input[type=checkbox] {
			position: relative;
			top: .3em;
			margin: .25em 0 1.25em 0;
		}

		label { padding: .5em; }
	}

	.settings-label {
		text-align: left;
		padding-right: 1em;

		@media #{$screenxx} {
			text-align: right;
			vertical-align: top;
			padding: .5em 0;
		}
	}

	.settings-action {
		text-align: left;
		vertical-align: middle;
	}
}

.conf-area { @include display-in(conf); }

.pref-area { @include display-in(pref); }

.room-area, .meta-area, .main-area, .chat-input {
    @include transition(.3s, ease-out); /* animate css transforms */

    /* fix flicker in some browsers */
    .meta-view &, .rooms-view & {
        -webkit-backface-visibility: hidden;
        -moz-backface-visibility: hidden;
        -ms-backface-visibility: hidden;
        backface-visibility: hidden;
        -webkit-perspective: 1000;
        -moz-perspective: 1000;
        -ms-perspective: 1000;
        perspective: 1000;
    }

    /* use 3d transformations for GPU accelerated animations */
    .meta-view & {
		@include transform(translate3d($width-meta, 0, 0));

		@media #{$screenx} { @include transform(translate3d($width-metax, 0, 0)); }

		@media #{$screenxx} { @include transform(translate3d($width-metaxx, 0, 0)); }

		@media #{$screenxxx} { @include transform(translate3d(0, 0, 0)); }
    }

    .rooms-view & {
		@include transform(translate3d( ( $width-room + $width-meta ), 0, 0));

		@media #{$screenx} { @include transform(translate3d( ( $width-roomxx + $width-metax ), 0, 0)); }

		@media #{$screenxx} { @include transform(translate3d( ( $width-roomxx + $width-metaxx ), 0, 0)); }

		@media #{$screenxxx} { @include transform(translate3d($width-roomxxx, 0, 0)); }

		@media #{$screenxxxx} { @include transform(translate3d(0, 0, 0)); }
    }
}

.search-bar {
	@include transform(translate3d(0, -100%, 0));
	@include opacity(0);
	@extend %ease;

	position: fixed;
	top: 0;
	left: 0;
    right: 0;
	z-index: 20;
	height: $bar-height;
	padding: .15em;
	background-color: darken($light-color, 5%);

	.search-focus & {
		@include transform(translate3d(0, 0, 0));
		@include opacity(1);
		@extend %nofilter;

		box-shadow: inset 0 -1px 0 0 darken($light-color, 20%),
			0 3px 2px -1px rgba(0,0,0,0.05);
	}

	.search-entry {
		position: relative;
		display: block;
		width: 100%;
		margin: 0;
		padding-left: 3.5em;
		background-image: url(../../img/client/icons/search-gray.svg);
		background-position: .5em center;
		background-repeat: no-repeat;
		background-size: 3em 2em;
	}
}

.infinite-above, .infinite-below {
    height: 100%;
    width: 100%;
}

.infinite-items { width: 100%; }

.signup-dialog {
    width: 27em;

    input { margin: .25em; }

    input[type=text] { width: 100%; }

	@media only screen and (max-width: 27em) { width: 100%; }
}

.loggedout-dialog {
    .button { width: 100%; }
}

.popover-body {
    width: 15em;

    .login-menu {
        padding: .5em 1em;

        .button { display: block; }
    }
}
